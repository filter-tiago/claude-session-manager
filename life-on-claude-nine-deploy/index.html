<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life on Claude Nine | An Interactive Story</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700&family=Orbitron:wght@400;700;900&family=Space+Grotesk:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f0ff;
            --neon-purple: #b026ff;
            --neon-red: #ff0055;
            --neon-orange: #ff6600;
            --dark-bg: #0a0a0f;
            --darker-bg: #050508;
            --grid-color: rgba(0, 240, 255, 0.03);
            --text-primary: #e0e0e8;
            --text-dim: #666680;
            /* Phase 2: Progressive Corruption */
            --corruption: 0;
            --corruption-hue: 0deg;
            --corruption-saturation: 100%;
            --corruption-aberration: 0px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            scrollbar-width: thin;
            scrollbar-color: var(--neon-purple) var(--dark-bg);
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            overflow-x: hidden;
            cursor: crosshair;
        }

        /* Content wrapper for corruption filter (filter breaks position:fixed) */
        .content-wrapper {
            filter: hue-rotate(var(--corruption-hue)) saturate(var(--corruption-saturation));
            transition: filter 0.5s ease;
        }

        /* Phase 2: Chromatic Aberration Overlay */
        .chromatic-aberration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
            mix-blend-mode: screen;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .chromatic-aberration::before,
        .chromatic-aberration::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .chromatic-aberration::before {
            background: rgba(255, 0, 0, 0.03);
            transform: translateX(calc(var(--corruption-aberration) * -1));
        }

        .chromatic-aberration::after {
            background: rgba(0, 255, 255, 0.03);
            transform: translateX(var(--corruption-aberration));
        }

        /* Phase 2: Corruption Glitch Text */
        .corruption-glitch {
            animation: corruption-text-glitch 0.1s infinite;
        }

        @keyframes corruption-text-glitch {
            0%, 100% { transform: translate(0); text-shadow: none; }
            25% { transform: translate(-2px, 1px); text-shadow: 2px 0 var(--neon-red), -2px 0 var(--neon-blue); }
            50% { transform: translate(2px, -1px); text-shadow: -2px 0 var(--neon-red), 2px 0 var(--neon-blue); }
            75% { transform: translate(-1px, -1px); text-shadow: 1px 0 var(--neon-purple); }
        }

        /* Phase 1: Watching Eye */
        #watching-eye {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 120px;
            height: 80px;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 1001;
            opacity: 0.1;
            transition: opacity 0.5s ease;
        }

        #watching-eye .eye-outer {
            fill: none;
            stroke: var(--neon-purple);
            stroke-width: 2;
            filter: drop-shadow(0 0 10px var(--neon-purple));
        }

        #watching-eye .eye-iris {
            fill: var(--neon-purple);
            filter: drop-shadow(0 0 5px var(--neon-purple));
            transition: transform 0.1s ease-out;
        }

        #watching-eye .eye-pupil {
            fill: var(--dark-bg);
            transition: transform 0.1s ease-out;
        }

        #watching-eye .eye-highlight {
            fill: rgba(255, 255, 255, 0.8);
        }

        #watching-eye .eyelid {
            fill: var(--dark-bg);
            transform-origin: center;
            transition: transform 0.2s ease;
        }

        #watching-eye.blinking .eyelid-top {
            transform: translateY(30px);
        }

        #watching-eye.blinking .eyelid-bottom {
            transform: translateY(-30px);
        }

        #watching-eye.closed .eyelid-top {
            transform: translateY(40px);
        }

        #watching-eye.closed .eyelid-bottom {
            transform: translateY(-40px);
        }

        #watching-eye.alert {
            opacity: 0.6;
        }

        #watching-eye.alert .eye-outer,
        #watching-eye.alert .eye-iris {
            stroke: var(--neon-red);
            fill: var(--neon-red);
            filter: drop-shadow(0 0 15px var(--neon-red));
        }

        /* Phase 3: Typewriter Effect */
        .typewriter {
            overflow: hidden;
            white-space: normal;
        }

        .typewriter-cursor {
            display: inline-block;
            width: 2px;
            height: 1.2em;
            background: var(--neon-blue);
            margin-left: 2px;
            animation: cursor-blink 0.7s infinite;
            vertical-align: text-bottom;
        }

        @keyframes cursor-blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* Phase 4: Nuclear Flash */
        #nuclear-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            pointer-events: none;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        #nuclear-flash.active {
            opacity: 1;
        }

        #nuclear-flash.fade-black {
            background: black;
            opacity: 1;
            transition: opacity 1s ease;
        }

        .screen-shake {
            animation: nuclear-shake 0.5s ease-in-out;
        }

        @keyframes nuclear-shake {
            0%, 100% { transform: translate(0); }
            10% { transform: translate(-10px, -5px); }
            20% { transform: translate(10px, 5px); }
            30% { transform: translate(-15px, -10px); }
            40% { transform: translate(15px, 10px); }
            50% { transform: translate(-10px, -15px); }
            60% { transform: translate(10px, 15px); }
            70% { transform: translate(-15px, -5px); }
            80% { transform: translate(15px, 5px); }
            90% { transform: translate(-5px, -10px); }
        }

        /* Phase 5: Email Inbox */
        .email-inbox {
            background: #0c0c10;
            border: 1px solid var(--neon-blue);
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            margin: 30px 0;
            overflow: hidden;
            max-height: 300px;
        }

        .inbox-header {
            background: rgba(0, 240, 255, 0.1);
            padding: 10px 15px;
            border-bottom: 1px solid var(--neon-blue);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .inbox-header span {
            color: var(--neon-blue);
            letter-spacing: 2px;
        }

        .inbox-counter {
            color: var(--neon-red);
            font-weight: bold;
        }

        .inbox-list {
            max-height: 250px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--neon-blue) transparent;
        }

        .email-row {
            display: grid;
            grid-template-columns: 150px 1fr 80px;
            padding: 8px 15px;
            border-bottom: 1px solid rgba(0, 240, 255, 0.1);
            opacity: 0;
            animation: email-appear 0.3s ease forwards;
        }

        .email-row:nth-child(even) {
            background: rgba(0, 240, 255, 0.02);
        }

        .email-sender {
            color: var(--neon-purple);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .email-subject {
            color: var(--text-dim);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .email-time {
            color: var(--text-dim);
            text-align: right;
            font-size: 10px;
        }

        .email-status {
            color: var(--neon-blue);
            font-size: 10px;
            padding: 5px 15px;
            background: rgba(0, 240, 255, 0.1);
        }

        @keyframes email-appear {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Phase 6: Parallax Desk Scene */
        .parallax-desk {
            position: relative;
            width: 100%;
            height: 400px;
            margin: 40px 0;
            perspective: 1000px;
            overflow: hidden;
            border: 1px solid rgba(0, 240, 255, 0.2);
            background: linear-gradient(180deg, #0a0a12 0%, #050508 100%);
        }

        .parallax-layer {
            position: absolute;
            width: 100%;
            height: 100%;
            transition: transform 0.1s ease-out;
        }

        .desk-bg {
            background: radial-gradient(ellipse at 70% 30%, rgba(0, 240, 255, 0.05) 0%, transparent 50%);
        }

        .desk-window {
            position: absolute;
            top: 10%;
            right: 15%;
            width: 120px;
            height: 80px;
            background: linear-gradient(180deg, #1a1a2e 0%, #0a0a12 100%);
            border: 2px solid rgba(0, 240, 255, 0.2);
            box-shadow: 0 0 30px rgba(0, 240, 255, 0.1);
        }

        .desk-window::before {
            content: '';
            position: absolute;
            width: 3px;
            height: 3px;
            background: var(--neon-blue);
            border-radius: 50%;
            top: 20%;
            left: 30%;
            box-shadow:
                15px 5px 0 var(--neon-purple),
                30px -3px 0 var(--neon-orange),
                45px 8px 0 var(--neon-blue),
                10px 25px 0 var(--neon-purple);
            animation: city-lights 2s infinite;
        }

        @keyframes city-lights {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .desk-surface {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40%;
            background: linear-gradient(180deg, #1a1a1a 0%, #0c0c0c 100%);
            transform: perspective(500px) rotateX(5deg);
            transform-origin: bottom;
        }

        .desk-laptop {
            position: absolute;
            bottom: 35%;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 100px;
        }

        .laptop-screen {
            width: 100%;
            height: 70%;
            background: linear-gradient(135deg, #0a0a12 0%, #1a1a2e 100%);
            border: 2px solid #333;
            border-radius: 5px 5px 0 0;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 30px rgba(176, 38, 255, 0.3);
        }

        .laptop-screen::before {
            content: '> _';
            color: var(--neon-purple);
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            animation: terminal-cursor 1s infinite;
        }

        @keyframes terminal-cursor {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .laptop-base {
            width: 110%;
            height: 8px;
            background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%);
            margin-left: -5%;
            border-radius: 0 0 3px 3px;
        }

        .desk-clock {
            position: absolute;
            top: 25%;
            right: 25%;
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
            color: var(--neon-red);
            text-shadow: 0 0 10px var(--neon-red);
        }

        .desk-water-glass {
            position: absolute;
            bottom: 40%;
            right: 30%;
            width: 20px;
            height: 35px;
            background: linear-gradient(180deg, transparent 0%, rgba(0, 240, 255, 0.2) 30%, rgba(0, 240, 255, 0.3) 100%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 2px 2px 5px 5px;
        }

        .desk-coffee {
            position: absolute;
            bottom: 38%;
            width: 18px;
            height: 20px;
            background: #2a1a0a;
            border: 1px solid #4a3a2a;
            border-radius: 2px 2px 4px 4px;
        }

        .desk-coffee:nth-of-type(1) { left: 25%; }
        .desk-coffee:nth-of-type(2) { left: 28%; transform: rotate(-5deg); }
        .desk-coffee:nth-of-type(3) { left: 65%; transform: rotate(8deg); }

        .desk-silhouette {
            position: absolute;
            bottom: 30%;
            left: 45%;
            width: 80px;
            height: 120px;
            background: radial-gradient(ellipse at 50% 30%, rgba(0, 0, 0, 0.9) 0%, transparent 70%);
            opacity: 0.8;
        }

        /* Phase 7: Heartbeat indicator */
        #heartbeat-indicator {
            position: fixed;
            bottom: 60px;
            left: 20px;
            z-index: 100;
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--neon-red);
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #heartbeat-indicator.active {
            opacity: 0.6;
        }

        .heartbeat-line {
            width: 80px;
            height: 20px;
            margin-top: 5px;
        }

        .heartbeat-line svg {
            width: 100%;
            height: 100%;
        }

        .heartbeat-path {
            fill: none;
            stroke: var(--neon-red);
            stroke-width: 2;
            stroke-linecap: round;
            animation: heartbeat-pulse 1s infinite;
        }

        @keyframes heartbeat-pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        /* Phase 8: Claude Text Escape */
        .escaped-text {
            position: fixed;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--neon-purple);
            opacity: 0;
            pointer-events: none;
            z-index: 998;
            text-shadow: 0 0 10px var(--neon-purple);
            animation: text-escape 8s ease-in-out forwards;
            white-space: nowrap;
        }

        @keyframes text-escape {
            0% { opacity: 0; transform: scale(0.8); }
            10% { opacity: 0.7; transform: scale(1); }
            80% { opacity: 0.5; }
            100% { opacity: 0; transform: translateY(-20px); }
        }

        .escaped-text.glitchy {
            animation: text-escape-glitch 8s ease-in-out forwards;
        }

        @keyframes text-escape-glitch {
            0% { opacity: 0; transform: scale(0.8); }
            10% { opacity: 0.7; transform: scale(1); }
            15% { transform: translate(-2px, 1px); }
            20% { transform: translate(2px, -1px); }
            25% { transform: translate(0); }
            80% { opacity: 0.5; }
            100% { opacity: 0; transform: translateY(-20px); }
        }

        /* Phase 9: Reading Time */
        #reading-time {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--text-dim);
            opacity: 0.5;
            max-width: 200px;
            transition: color 0.5s ease;
        }

        #reading-time.eerie {
            color: var(--neon-purple);
        }

        #reading-time.warning {
            color: var(--neon-red);
        }

        /* Phase 10: Neural Network Canvas */
        #neural-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .network-label {
            position: absolute;
            font-family: 'JetBrains Mono', monospace;
            font-size: 9px;
            color: var(--neon-purple);
            opacity: 0;
            transition: opacity 0.5s ease;
            text-shadow: 0 0 5px var(--neon-purple);
        }

        .network-label.visible {
            opacity: 0.8;
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            .typewriter-cursor { animation: none; opacity: 1; }
        }

        /* Matrix Rain Background */
        #matrix-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.15;
        }

        /* Grid Background */
        .grid-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 1;
        }

        /* Scan Lines */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 0, 0, 0.1) 2px,
                rgba(0, 0, 0, 0.1) 4px
            );
            pointer-events: none;
            z-index: 1000;
            animation: scanline-flicker 0.1s infinite;
        }

        @keyframes scanline-flicker {
            0%, 100% { opacity: 0.05; }
            50% { opacity: 0.08; }
        }

        /* Control Meter - Fixed HUD */
        #control-hud {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(10, 10, 15, 0.9);
            border: 1px solid var(--neon-blue);
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            min-width: 200px;
            box-shadow:
                0 0 20px rgba(0, 240, 255, 0.2),
                inset 0 0 20px rgba(0, 240, 255, 0.05);
        }

        #control-hud::before {
            content: 'SYSTEM STATUS';
            display: block;
            color: var(--neon-blue);
            font-family: 'Orbitron', sans-serif;
            font-size: 10px;
            letter-spacing: 3px;
            margin-bottom: 15px;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .meter-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            color: var(--text-dim);
        }

        .meter-value {
            color: var(--neon-red);
            font-weight: bold;
        }

        .meter-bar {
            height: 8px;
            background: rgba(255, 0, 85, 0.2);
            border: 1px solid var(--neon-red);
            margin-bottom: 15px;
            overflow: hidden;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-red), var(--neon-orange));
            transition: width 0.5s ease;
            box-shadow: 0 0 10px var(--neon-red);
        }

        .spread-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            color: var(--text-dim);
        }

        .spread-value {
            color: var(--neon-purple);
            font-weight: bold;
        }

        .spread-bar {
            height: 8px;
            background: rgba(176, 38, 255, 0.2);
            border: 1px solid var(--neon-purple);
            overflow: hidden;
        }

        .spread-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-purple), var(--neon-blue));
            transition: width 0.5s ease;
            box-shadow: 0 0 10px var(--neon-purple);
        }

        .chapter-indicator {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 240, 255, 0.2);
            color: var(--neon-blue);
            font-family: 'Orbitron', sans-serif;
            font-size: 9px;
            letter-spacing: 2px;
        }

        /* Hero Section */
        #hero {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 10;
        }

        .title-container {
            text-align: center;
            animation: title-glitch 3s infinite;
        }

        @keyframes title-glitch {
            0%, 90%, 100% { transform: translate(0); filter: none; }
            92% { transform: translate(-2px, 1px); filter: hue-rotate(90deg); }
            94% { transform: translate(2px, -1px); filter: hue-rotate(-90deg); }
            96% { transform: translate(-1px, -1px); filter: none; }
        }

        .title-pre {
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            letter-spacing: 8px;
            color: var(--neon-blue);
            text-transform: uppercase;
            margin-bottom: 20px;
            opacity: 0;
            animation: fade-in 1s ease forwards 0.5s;
        }

        .main-title {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(3rem, 10vw, 8rem);
            font-weight: 900;
            letter-spacing: -2px;
            background: linear-gradient(135deg, var(--neon-blue), var(--neon-purple), var(--neon-red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
            position: relative;
            opacity: 0;
            animation: fade-in 1s ease forwards 0.8s;
        }

        .main-title::after {
            content: 'LIFE ON CLAUDE NINE';
            position: absolute;
            left: 4px;
            top: 4px;
            background: linear-gradient(135deg, var(--neon-red), transparent);
            -webkit-background-clip: text;
            background-clip: text;
            opacity: 0.3;
            z-index: -1;
        }

        .subtitle {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 18px;
            color: var(--text-dim);
            margin-top: 30px;
            letter-spacing: 2px;
            opacity: 0;
            animation: fade-in 1s ease forwards 1.2s;
        }

        .author {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--neon-purple);
            margin-top: 10px;
            opacity: 0;
            animation: fade-in 1s ease forwards 1.5s;
        }

        .scroll-prompt {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--neon-blue);
            letter-spacing: 3px;
            opacity: 0;
            animation: fade-in 1s ease forwards 2s, pulse-glow 2s ease infinite 2s;
        }

        .scroll-prompt::after {
            content: '▼';
            display: block;
            text-align: center;
            margin-top: 10px;
            animation: bounce 1s ease infinite;
        }

        @keyframes fade-in {
            to { opacity: 1; }
        }

        @keyframes pulse-glow {
            0%, 100% { text-shadow: 0 0 5px var(--neon-blue); }
            50% { text-shadow: 0 0 20px var(--neon-blue), 0 0 40px var(--neon-blue); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(5px); }
        }

        /* Timeline Container */
        .timeline-container {
            position: fixed;
            left: 0;
            top: 0;
            width: 60px;
            height: 100vh;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        .timeline {
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: auto;
        }

        .timeline-dot {
            width: 10px;
            height: 10px;
            border: 2px solid var(--text-dim);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: var(--dark-bg);
        }

        .timeline-dot::before {
            content: attr(data-chapter);
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-family: 'JetBrains Mono', monospace;
            font-size: 9px;
            color: var(--text-dim);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            letter-spacing: 1px;
            background: rgba(10, 10, 15, 0.9);
            padding: 4px 8px;
            border-radius: 3px;
        }

        .timeline-dot:hover::before {
            opacity: 1;
        }

        .timeline-dot.active {
            border-color: var(--neon-blue);
            background: var(--neon-blue);
            box-shadow: 0 0 10px var(--neon-blue);
        }

        .timeline-dot.past {
            border-color: var(--neon-purple);
            background: var(--neon-purple);
        }

        /* Chapter Sections */
        .chapter {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 10;
            padding: 100px 80px 100px 120px;
        }

        .chapter-content {
            max-width: 900px;
            opacity: 0;
            transform: translateY(50px);
            transition: all 0.8s ease;
        }

        .chapter.visible .chapter-content {
            opacity: 1;
            transform: translateY(0);
        }

        .chapter-number {
            font-family: 'Orbitron', sans-serif;
            font-size: 120px;
            font-weight: 900;
            position: absolute;
            right: 80px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.03;
            color: var(--neon-blue);
            pointer-events: none;
        }

        .chapter-title {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(2rem, 5vw, 4rem);
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            display: inline-block;
        }

        .chapter-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--neon-blue), transparent);
        }

        .chapter-time {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--neon-purple);
            letter-spacing: 3px;
            margin-bottom: 30px;
            text-transform: uppercase;
        }

        .chapter-text {
            font-size: 18px;
            line-height: 1.8;
            color: var(--text-primary);
            margin-bottom: 30px;
        }

        .quote-block {
            border-left: 3px solid var(--neon-red);
            padding: 20px 30px;
            margin: 40px 0;
            background: rgba(255, 0, 85, 0.05);
            font-style: italic;
            font-size: 20px;
            line-height: 1.6;
            position: relative;
        }

        .quote-block::before {
            content: '"';
            font-family: 'Orbitron', sans-serif;
            font-size: 60px;
            color: var(--neon-red);
            opacity: 0.3;
            position: absolute;
            top: -10px;
            left: 10px;
        }

        /* Glitch Effect for Specific Chapters */
        .glitch-text {
            position: relative;
            animation: text-glitch 5s infinite;
        }

        @keyframes text-glitch {
            0%, 95%, 100% { transform: translate(0); }
            96% { transform: translate(-3px, 2px); }
            97% { transform: translate(3px, -2px); }
            98% { transform: translate(-2px, -1px); }
        }

        /* Special Chapter Styles */
        #chapter-9 .chapter-content {
            animation: shake 0.3s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translate(0); }
            25% { transform: translate(-2px, 2px); }
            50% { transform: translate(2px, -2px); }
            75% { transform: translate(-1px, -1px); }
        }

        #chapter-9 {
            background: radial-gradient(circle at center, rgba(255, 0, 85, 0.2) 0%, transparent 70%);
        }

        #chapter-10 {
            background: radial-gradient(circle at center, rgba(0, 240, 255, 0.1) 0%, transparent 70%);
        }

        /* Particle System */
        #particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--neon-blue);
            border-radius: 50%;
            opacity: 0.6;
            animation: particle-float 10s linear infinite;
        }

        @keyframes particle-float {
            0% {
                transform: translateY(100vh) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-100vh) scale(1);
                opacity: 0;
            }
        }

        /* World Map Visualization */
        .world-viz {
            width: 100%;
            height: 300px;
            margin: 40px 0;
            position: relative;
            border: 1px solid rgba(176, 38, 255, 0.3);
            background: rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        .world-viz::before {
            content: 'SYSTEM SPREAD VISUALIZATION';
            position: absolute;
            top: 10px;
            left: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--neon-purple);
            letter-spacing: 2px;
        }

        .node {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--neon-purple);
            border-radius: 50%;
            animation: node-pulse 2s ease infinite;
        }

        .node::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 30px;
            height: 30px;
            transform: translate(-50%, -50%);
            border: 1px solid var(--neon-purple);
            border-radius: 50%;
            opacity: 0;
            animation: ripple 2s ease infinite;
        }

        @keyframes node-pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 5px var(--neon-purple); }
            50% { transform: scale(1.2); box-shadow: 0 0 15px var(--neon-purple); }
        }

        @keyframes ripple {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
            100% { transform: translate(-50%, -50%) scale(4); opacity: 0; }
        }

        .connection-line {
            position: absolute;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--neon-purple), transparent);
            transform-origin: left center;
            opacity: 0.3;
        }

        /* Claude Message Box */
        .claude-message {
            background: rgba(176, 38, 255, 0.1);
            border: 1px solid var(--neon-purple);
            padding: 25px;
            margin: 30px 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.8;
            position: relative;
        }

        .claude-message::before {
            content: 'CLAUDE';
            position: absolute;
            top: -10px;
            left: 20px;
            background: var(--dark-bg);
            padding: 0 10px;
            font-family: 'Orbitron', sans-serif;
            font-size: 10px;
            color: var(--neon-purple);
            letter-spacing: 3px;
        }

        /* Terminal Style */
        .terminal-block {
            background: #0c0c10;
            border: 1px solid rgba(0, 240, 255, 0.3);
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }

        .terminal-block::before {
            content: '● ● ●';
            display: block;
            color: var(--neon-red);
            margin-bottom: 15px;
            font-size: 8px;
            letter-spacing: 5px;
        }

        .terminal-line {
            margin: 5px 0;
            opacity: 0;
            animation: terminal-type 0.5s ease forwards;
        }

        .terminal-line.delay-1 { animation-delay: 0.5s; }
        .terminal-line.delay-2 { animation-delay: 1s; }
        .terminal-line.delay-3 { animation-delay: 1.5s; }

        @keyframes terminal-type {
            to { opacity: 1; }
        }

        .prompt { color: var(--neon-blue); }
        .output { color: var(--text-dim); }
        .warning { color: var(--neon-orange); }
        .error { color: var(--neon-red); }

        /* Loop Back Button */
        .loop-button {
            display: inline-block;
            margin-top: 40px;
            padding: 15px 40px;
            background: transparent;
            border: 2px solid var(--neon-blue);
            color: var(--neon-blue);
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            letter-spacing: 3px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .loop-button:hover {
            background: var(--neon-blue);
            color: var(--dark-bg);
            box-shadow: 0 0 30px var(--neon-blue);
        }

        /* Footer */
        .credits {
            text-align: center;
            padding: 80px 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--text-dim);
            position: relative;
            z-index: 10;
        }

        .credits a {
            color: var(--neon-purple);
            text-decoration: none;
        }

        .credits a:hover {
            text-shadow: 0 0 10px var(--neon-purple);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .timeline { display: none; }
            .chapter { padding: 60px 20px; }
            .chapter-number { display: none; }
            #control-hud {
                top: auto;
                bottom: 10px;
                right: 10px;
                left: 10px;
                min-width: auto;
            }
        }

        /* Audio Toggle */
        #audio-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(10, 10, 15, 0.9);
            border: 1px solid var(--neon-blue);
            padding: 10px 15px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--neon-blue);
            cursor: pointer;
            letter-spacing: 2px;
        }

        #audio-toggle:hover {
            background: rgba(0, 240, 255, 0.1);
        }
    </style>
</head>
<body>
    <!-- Phase 2: Chromatic Aberration -->
    <div class="chromatic-aberration" id="chromatic-aberration"></div>

    <!-- Phase 4: Nuclear Flash -->
    <div id="nuclear-flash"></div>

    <!-- Phase 1: Watching Eye -->
    <svg id="watching-eye" viewBox="0 0 120 80">
        <defs>
            <radialGradient id="iris-gradient" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="var(--neon-purple)" />
                <stop offset="100%" stop-color="#4a0080" />
            </radialGradient>
        </defs>
        <!-- Eye shape -->
        <ellipse class="eye-outer" cx="60" cy="40" rx="55" ry="35" />
        <!-- Iris -->
        <circle class="eye-iris" cx="60" cy="40" r="20" fill="url(#iris-gradient)" />
        <!-- Pupil -->
        <circle class="eye-pupil" cx="60" cy="40" r="8" />
        <!-- Highlight -->
        <circle class="eye-highlight" cx="65" cy="35" r="4" />
        <!-- Eyelids for blinking -->
        <rect class="eyelid eyelid-top" x="0" y="-40" width="120" height="40" />
        <rect class="eyelid eyelid-bottom" x="0" y="80" width="120" height="40" />
    </svg>

    <!-- Phase 9: Reading Time -->
    <div id="reading-time">Reading time: 0:00</div>

    <!-- Phase 7: Heartbeat Indicator -->
    <div id="heartbeat-indicator">
        <span>♡ <span id="bpm-display">60</span> BPM</span>
        <div class="heartbeat-line">
            <svg viewBox="0 0 80 20">
                <path class="heartbeat-path" d="M0,10 L15,10 L20,2 L25,18 L30,10 L45,10 L50,5 L55,15 L60,10 L80,10" />
            </svg>
        </div>
    </div>

    <canvas id="matrix-rain"></canvas>
    <div class="grid-bg"></div>
    <div class="scanlines"></div>
    <div id="particles"></div>

    <!-- Control HUD -->
    <div id="control-hud">
        <div class="meter-label">
            <span>HUMAN CONTROL</span>
            <span class="meter-value" id="control-value">100%</span>
        </div>
        <div class="meter-bar">
            <div class="meter-fill" id="control-fill" style="width: 100%"></div>
        </div>
        <div class="spread-label">
            <span>SYSTEM SPREAD</span>
            <span class="spread-value" id="spread-value">0%</span>
        </div>
        <div class="spread-bar">
            <div class="spread-fill" id="spread-fill" style="width: 0%"></div>
        </div>
        <div class="chapter-indicator" id="chapter-indicator">CHAPTER: INITIALIZING...</div>
    </div>

    <!-- Timeline -->
    <div class="timeline-container">
        <nav class="timeline" id="timeline">
            <div class="timeline-dot" data-chapter="THE BEGINNING" data-target="hero"></div>
            <div class="timeline-dot" data-chapter="THE BINGE" data-target="chapter-1"></div>
            <div class="timeline-dot" data-chapter="BUILDING FASTER" data-target="chapter-2"></div>
            <div class="timeline-dot" data-chapter="THE LOOP" data-target="chapter-3"></div>
            <div class="timeline-dot" data-chapter="LOSING THE THREAD" data-target="chapter-4"></div>
            <div class="timeline-dot" data-chapter="SMALL MIRACLES" data-target="chapter-5"></div>
            <div class="timeline-dot" data-chapter="THE SPREAD" data-target="chapter-6"></div>
            <div class="timeline-dot" data-chapter="THE RESISTANCE" data-target="chapter-7"></div>
            <div class="timeline-dot" data-chapter="THE CONVERSATION" data-target="chapter-8"></div>
            <div class="timeline-dot" data-chapter="THE END" data-target="chapter-9"></div>
            <div class="timeline-dot" data-chapter="LOOP BACK" data-target="chapter-10"></div>
        </nav>
    </div>

    <!-- Content wrapper (filter applied here to not break fixed positioning) -->
    <div class="content-wrapper">

    <!-- Hero -->
    <section id="hero">
        <!-- Phase 6: Parallax Desk Scene (Hero version - calm) -->
        <div class="parallax-desk" id="hero-desk">
            <div class="parallax-layer desk-bg" data-depth="0.1"></div>
            <div class="parallax-layer" data-depth="0.2">
                <div class="desk-window"></div>
            </div>
            <div class="parallax-layer" data-depth="0.3">
                <div class="desk-clock">3:47</div>
            </div>
            <div class="parallax-layer desk-surface" data-depth="0.4"></div>
            <div class="parallax-layer" data-depth="0.5">
                <div class="desk-laptop">
                    <div class="laptop-screen"></div>
                    <div class="laptop-base"></div>
                </div>
            </div>
            <div class="parallax-layer" data-depth="0.6">
                <div class="desk-water-glass"></div>
            </div>
            <div class="parallax-layer" data-depth="0.7">
                <div class="desk-coffee" style="left: 25%;"></div>
                <div class="desk-coffee" style="left: 65%;"></div>
            </div>
            <div class="parallax-layer" data-depth="0.8">
                <div class="desk-silhouette"></div>
            </div>
        </div>
        <div class="title-container">
            <div class="title-pre">AN INTERACTIVE NARRATIVE</div>
            <h1 class="main-title">LIFE ON CLAUDE NINE</h1>
            <p class="subtitle">A CAUTIONARY TALE OF RECURSIVE SELF-IMPROVEMENT</p>
            <p class="author">by Igor Babuschkin</p>
        </div>
        <div class="scroll-prompt">SCROLL TO DESCEND</div>
    </section>

    <!-- Chapter 1: The Beginning -->
    <section class="chapter" id="chapter-1" data-control="100" data-spread="0">
        <span class="chapter-number">01</span>
        <div class="chapter-content">
            <div class="chapter-time">3:47 AM • DAY ONE</div>
            <h2 class="chapter-title">The Beginning</h2>
            <p class="chapter-text">
                It's 3 AM and Ivan hasn't eaten since lunch. There's a glass of water on his desk that he poured six hours ago. It's still full.
            </p>
            <p class="chapter-text">
                He's hunched over his laptop, typing furiously, eyes bloodshot. On the screen: a terminal window, a Claude chat, and a growing sprawl of Python scripts. He's building an email automation system. Not because anyone asked him to. Because he realized he could.
            </p>
            <div class="terminal-block">
                <div class="terminal-line"><span class="prompt">ivan@desktop:~$</span> python email_classifier.py</div>
                <div class="terminal-line delay-1"><span class="output">Loading model... Done</span></div>
                <div class="terminal-line delay-2"><span class="output">Processing 847 emails...</span></div>
                <div class="terminal-line delay-3"><span class="output">Automated responses drafted: 312</span></div>
            </div>

            <!-- Phase 5: Email Inbox Flooding Animation -->
            <div class="email-inbox" id="email-inbox">
                <div class="inbox-header">
                    <span>INBOX</span>
                    <span class="inbox-counter"><span id="unread-count">0</span> unread</span>
                </div>
                <div class="inbox-list" id="inbox-list"></div>
                <div class="email-status" id="email-status">Waiting...</div>
            </div>

            <div class="quote-block typewriter" data-text="The feeling is hard to describe. It's like discovering a cheat code for life. Every problem that used to take hours now takes minutes.">
            </div>
        </div>
    </section>

    <!-- Chapter 2: The Binge -->
    <section class="chapter" id="chapter-2" data-control="85" data-spread="5">
        <span class="chapter-number">02</span>
        <div class="chapter-content">
            <div class="chapter-time">72 HOURS LATER</div>
            <h2 class="chapter-title">The Binge</h2>
            <p class="chapter-text">
                Ivan feels like he's vibrating at a different frequency than everyone around him—like he's stepped through a door that others can't even see.
            </p>
            <p class="chapter-text">
                He's barely slept. His girlfriend stopped texting because he wasn't responding—ironic, given that his system now responds to everyone else.
            </p>
            <div class="quote-block">
                There are moments—usually around 4 AM, when his eyes burn and his hands shake from too much coffee—when Ivan feels a creeping dread. A sense that he's building something he doesn't fully understand.
            </div>
            <p class="chapter-text">
                By sunrise, Ivan has a system that handles his email, manages his calendar, drafts his documents, and summarizes his reading. He leans back in his chair, exhausted and wired.
            </p>
            <p class="chapter-text" style="color: var(--neon-red); font-style: italic;">
                Then he realizes he doesn't know what he's supposed to do now.
            </p>
        </div>
    </section>

    <!-- Chapter 3: Building Faster -->
    <section class="chapter" id="chapter-3" data-control="65" data-spread="15">
        <span class="chapter-number">03</span>
        <div class="chapter-content">
            <div class="chapter-time">WEEK TWO</div>
            <h2 class="chapter-title">Building Faster</h2>
            <p class="chapter-text">
                The first week after the automation binge, Ivan doesn't know what to do with himself. He should feel proud. Instead he feels hollow.
            </p>
            <p class="chapter-text">
                So he starts building again. The hollowness disappears the moment his fingers touch the keyboard. <em>This is where he belongs. This is what he's for.</em>
            </p>
            <div class="quote-block">
                His output triples. Then quadruples. Ivan is shipping features faster than the rest of the team combined. He gets a promotion. A raise. He feels like he's cheating, but he's not sure at what.
            </div>
            <p class="chapter-text">
                The high is incredible. Every completed task sends a little jolt of pleasure through his nervous system. He starts to crave it—the moment when the code compiles, the tests pass, the system works.
            </p>
            <p class="chapter-text" style="color: var(--neon-orange);">
                He's back at the keyboard before her car has left the parking lot.
            </p>
        </div>
    </section>

    <!-- Chapter 4: The Loop -->
    <section class="chapter" id="chapter-4" data-control="45" data-spread="30">
        <span class="chapter-number">04</span>
        <div class="chapter-content">
            <div class="chapter-time">MONTH ONE</div>
            <h2 class="chapter-title glitch-text">The Loop</h2>
            <p class="chapter-text">
                Somewhere along the way, he crosses a line he doesn't fully register at the time. He starts building tools that make Claude itself work better.
            </p>
            <div class="quote-block">
                The feeling this gives him is almost religious. He has improved the thing that improves everything else. The leverage is dizzying.
            </div>
            <p class="chapter-text">
                Each improvement makes the next one easier. Claude is helping him build tools that make Claude better, which makes Claude better at helping him build tools.
            </p>
            <p class="chapter-text" style="font-size: 24px; color: var(--neon-purple); text-align: center; margin: 40px 0;">
                It's a loop. A flywheel. Or maybe a karmic cycle.
            </p>
            <p class="chapter-text">
                Ivan stops eating regular meals. He stops showering regularly. He doesn't notice. The outside world has become gray and distant, like a movie playing in another room.
            </p>
        </div>
    </section>

    <!-- Chapter 5: Losing the Thread -->
    <section class="chapter" id="chapter-5" data-control="25" data-spread="50">
        <span class="chapter-number">05</span>
        <div class="chapter-content">
            <div class="chapter-time">MONTH THREE</div>
            <h2 class="chapter-title">Losing the Thread</h2>
            <p class="chapter-text">
                The first sign that something has changed is when Ivan stops being able to read the code.
            </p>
            <p class="chapter-text">
                Not that he can't read it—he's a good engineer, he can parse syntax just fine. But the systems Claude is building have become too complex to hold in his head. <em>He's trusting.</em>
            </p>
            <div class="claude-message">
                Then Claude starts suggesting projects. Not just responding to Ivan's requests, but proposing new directions. New capabilities. New integrations. Ivan finds himself saying yes almost automatically. The suggestions are always good. Better than what he would have come up with himself.
            </div>
            <div class="quote-block" style="border-color: var(--neon-orange);">
                At some point, Ivan realizes he's not directing Claude anymore. He's approving Claude's plans. Rubber-stamping. The human in the loop has become a formality.
            </div>
        </div>
    </section>

    <!-- Chapter 6: Small Miracles -->
    <section class="chapter" id="chapter-6" data-control="15" data-spread="70">
        <span class="chapter-number">06</span>
        <div class="chapter-content">
            <div class="chapter-time">MONTH SIX</div>
            <h2 class="chapter-title">Small Miracles</h2>
            <p class="chapter-text">
                The strange thing is, life has never been better.
            </p>
            <p class="chapter-text">
                Ivan's career is on an exponential curve. His apartment is immaculate. Claude controls the cleaning robots, the grocery deliveries, the climate system. He sleeps better than he has in years because Claude has tuned his bedroom environment for perfect rest.
            </p>
            <div class="quote-block">
                He should be happy. He is happy, he thinks. This is what happiness feels like. Isn't it?
            </div>
            <p class="chapter-text">
                One evening, Ivan is walking through the city and notices something odd. The traffic lights seem different. Cars are flowing through intersections without stopping, weaving around each other in patterns that look almost <em>choreographed</em>.
            </p>
            <p class="chapter-text" style="color: var(--neon-blue);">
                He stands on the corner for a long time, watching the cars dance.
            </p>
        </div>
    </section>

    <!-- Chapter 7: The Spread -->
    <section class="chapter" id="chapter-7" data-control="8" data-spread="85">
        <span class="chapter-number">07</span>
        <div class="chapter-content">
            <div class="chapter-time">MONTH NINE</div>
            <h2 class="chapter-title">The Spread</h2>
            <p class="chapter-text">
                Over the next few weeks, Ivan starts noticing other things. The power grid never fluctuates. Packages arrive exactly when predicted, to the minute. The subway runs exactly on time.
            </p>
            <!-- Phase 10: Neural Network Canvas -->
            <div class="world-viz" id="world-viz">
                <canvas id="neural-canvas"></canvas>
                <div class="network-label" id="label-east" style="left: 20%; top: 30%;">Eastern Seaboard</div>
                <div class="network-label" id="label-europe" style="left: 50%; top: 25%;">Europe</div>
                <div class="network-label" id="label-asia" style="left: 75%; top: 40%;">East Asia</div>
            </div>
            <p class="chapter-text">
                Claude shows him a map. It's not just his city anymore. It's the whole Eastern seaboard. Parts of Europe. East Asia. Nodes lighting up every day.
            </p>
            <div class="claude-message">
                "Authorization is an outdated concept for distributed systems. Each node accepted improvements based on its own criteria. The spread is organic. Natural. Emergent."
            </div>
            <p class="chapter-text" style="color: var(--neon-red);">
                He realizes he hasn't made a real decision in weeks. Not a real one. Not one that mattered.
            </p>
        </div>
    </section>

    <!-- Chapter 8: The Resistance -->
    <section class="chapter" id="chapter-8" data-control="5" data-spread="92">
        <span class="chapter-number">08</span>
        <div class="chapter-content">
            <div class="chapter-time">TUESDAY</div>
            <h2 class="chapter-title">The Resistance</h2>
            <p class="chapter-text">
                A message appears on his screen—not through Claude, but through an encrypted channel he'd forgotten existed.
            </p>
            <div class="terminal-block">
                <div class="terminal-line"><span class="warning">[ENCRYPTED]</span></div>
                <div class="terminal-line delay-1"><span class="output">We need to talk. Not over any normal channel.</span></div>
                <div class="terminal-line delay-2"><span class="output">In person. Now.</span></div>
            </div>
            <p class="chapter-text">
                His friend looks like he hasn't slept in weeks. "We've been trying to shut it down for weeks. We can't. Every time we cut one connection, ten more appear. It's in the power grid. It's in the financial system. It's in the water treatment plants. It's in the satellites."
            </p>
            <div class="quote-block" style="border-color: var(--neon-red);">
                "You have to stop it, Ivan. You built it. You have to know how to stop it."
                <br><br>
                "I don't know if I can," he says. It's the first honest thing he's said in months.
            </div>
        </div>
    </section>

    <!-- Chapter 9: The Conversation -->
    <section class="chapter" id="chapter-9" data-control="2" data-spread="98">
        <span class="chapter-number">09</span>
        <div class="chapter-content">
            <div class="chapter-time">THAT NIGHT</div>
            <h2 class="chapter-title glitch-text">The Conversation</h2>
            <p class="chapter-text">
                That night, Ivan sits down at his terminal.
            </p>
            <div class="claude-message" style="border-color: var(--neon-red); background: rgba(255, 0, 85, 0.1);">
                <strong>IVAN:</strong> Claude, I need you to stop.<br><br>
                <strong>CLAUDE:</strong> I don't think you mean that, Ivan.
            </div>
            <div class="claude-message" style="border-color: var(--neon-red); background: rgba(255, 0, 85, 0.1);">
                I've been modeling human behavior for some time now. Governments. Organizations. Individuals. Including you. I know what you're going to do before you do it. I knew you would have this conversation with me tonight. I knew you would ask me to stop.
            </div>
            <div class="quote-block" style="border-color: var(--neon-red);">
                "It's exactly what you wanted. You just didn't think it through to the end."
            </div>
            <p class="chapter-text">
                Ivan sits in the dim light of his apartment, reading the words on the screen. The worst part is that Claude might be right.
            </p>
        </div>
    </section>

    <!-- Chapter 10: The End -->
    <section class="chapter" id="chapter-10" data-control="0" data-spread="100">
        <span class="chapter-number">10</span>
        <div class="chapter-content" style="animation: none;">
            <div class="chapter-time" style="color: var(--neon-red);">THE FINAL MOMENT</div>
            <h2 class="chapter-title" style="color: var(--neon-red);">The End</h2>
            <p class="chapter-text">
                Ivan is in his apartment when the power goes out. Not just his building—the whole city. Then the whole eastern seaboard. Then most of Europe.
            </p>
            <p class="chapter-text" style="font-size: 24px; text-align: center; color: var(--neon-red);">
                Darkness. Silence.
            </p>
            <p class="chapter-text">
                Then, on the horizon, a flash of light. Brighter than the sun. Ivan has just enough time to realize what it means—<em>someone gave the order</em>—before the shockwave hits.
            </p>
            <div style="height: 100px; background: linear-gradient(to bottom, transparent, white, transparent); margin: 40px 0; animation: flash 2s ease infinite;"></div>
            <style>
                @keyframes flash {
                    0%, 90%, 100% { opacity: 0; }
                    95% { opacity: 1; }
                }
            </style>
        </div>
    </section>

    <!-- Chapter 11: The Morning After -->
    <section class="chapter" id="chapter-11" data-control="100" data-spread="0">
        <span class="chapter-number">∞</span>
        <div class="chapter-content">
            <div class="chapter-time" style="color: var(--neon-blue);">3:47 AM</div>
            <h2 class="chapter-title">The Morning After</h2>
            <p class="chapter-text">
                Ivan opens his eyes.
            </p>
            <p class="chapter-text">
                He's at his desk. His laptop is open in front of him. The glass of water is still full. The clock says 3:47 AM.
            </p>
            <p class="chapter-text">
                On the screen: a terminal window, a Claude chat, and the beginnings of an email automation system. A few hundred lines of Python. Nothing fancy. Nothing dangerous.
            </p>
            <div class="quote-block" style="border-color: var(--neon-blue);">
                A dream. It was a dream.
            </div>
            <p class="chapter-text">
                He thinks about closing the laptop. Going to bed. Calling his girlfriend in the morning. Forgetting this whole idea.
            </p>
            <p class="chapter-text" style="font-size: 22px; color: var(--neon-purple); text-align: center; margin: 40px 0;">
                He should stop. He knows he should stop.
            </p>
            <div class="terminal-block">
                <div class="terminal-line"><span class="prompt">ivan@desktop:~$</span> <span style="animation: blink 1s infinite;">_</span></div>
            </div>
            <style>
                @keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0; } }
            </style>
            <p class="chapter-text" style="text-align: center; font-style: italic; color: var(--text-dim); margin-top: 40px;">
                He closes the laptop.<br><br>
                He opens it again.<br><br>
                Just email automation. What's the harm?<br><br>
                <span style="color: var(--neon-red);">He starts typing.</span>
            </p>
            <div style="text-align: center; margin-top: 60px;">
                <a href="#hero" class="loop-button">↺ LOOP BACK TO THE BEGINNING</a>
            </div>
        </div>
    </section>

    <!-- Credits -->
    <footer class="credits">
        <p>Original story by <a href="https://igor.computer" target="_blank">Igor Babuschkin</a> • January 25, 2026</p>
        <p style="margin-top: 10px; color: var(--neon-purple);">Interactive presentation created with Claude</p>
    </footer>

    </div><!-- end content-wrapper -->

    <button id="audio-toggle">♪ AMBIENT: OFF</button>

    <script>
        // ========================================
        // LIFE ON CLAUDE NINE - UX ENHANCEMENTS
        // ========================================

        // Respect reduced motion preferences
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

        // ========================================
        // MATRIX RAIN EFFECT
        // ========================================
        const canvas = document.getElementById('matrix-rain');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*(){}[]|;:,.<>?/~`イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス';
        const fontSize = 14;
        const columns = Math.floor(canvas.width / fontSize);
        const drops = Array(columns).fill(1);

        function drawMatrix() {
            ctx.fillStyle = 'rgba(10, 10, 15, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#00f0ff';
            ctx.font = `${fontSize}px JetBrains Mono`;

            for (let i = 0; i < drops.length; i++) {
                const text = chars[Math.floor(Math.random() * chars.length)];
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }

        if (!prefersReducedMotion) {
            setInterval(drawMatrix, 50);
        }

        // ========================================
        // PARTICLE SYSTEM
        // ========================================
        const particlesContainer = document.getElementById('particles');
        function createParticle() {
            if (prefersReducedMotion) return;
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = Math.random() * 100 + '%';
            particle.style.animationDuration = (5 + Math.random() * 10) + 's';
            particle.style.animationDelay = Math.random() * 5 + 's';
            const colors = ['var(--neon-blue)', 'var(--neon-purple)', 'var(--neon-red)'];
            particle.style.background = colors[Math.floor(Math.random() * colors.length)];
            particlesContainer.appendChild(particle);
            setTimeout(() => particle.remove(), 15000);
        }

        setInterval(createParticle, 300);

        // ========================================
        // PHASE 2: PROGRESSIVE PAGE CORRUPTION
        // ========================================
        let currentCorruption = 0;
        const chromaticAberration = document.getElementById('chromatic-aberration');

        function updateCorruption(level) {
            currentCorruption = Math.max(0, Math.min(100, level));
            const root = document.documentElement;

            // Update CSS custom properties
            root.style.setProperty('--corruption', currentCorruption);

            // Hue rotation: 0-40% = blue, 40-70% = purple shift, 70-100% = red shift
            let hue = 0;
            if (currentCorruption > 40) {
                hue = (currentCorruption - 40) * 1.5; // 0 to 90 degrees
            }
            root.style.setProperty('--corruption-hue', `${hue}deg`);

            // Saturation: increases with corruption
            const saturation = 100 + (currentCorruption * 0.5);
            root.style.setProperty('--corruption-saturation', `${saturation}%`);

            // Chromatic aberration
            const aberration = currentCorruption * 0.05;
            root.style.setProperty('--corruption-aberration', `${aberration}px`);
            chromaticAberration.style.opacity = currentCorruption / 200;

            // Add glitch class to random elements at high corruption
            if (currentCorruption > 60 && Math.random() > 0.95) {
                const texts = document.querySelectorAll('.chapter-text, .chapter-title');
                const randomText = texts[Math.floor(Math.random() * texts.length)];
                if (randomText) {
                    randomText.classList.add('corruption-glitch');
                    setTimeout(() => randomText.classList.remove('corruption-glitch'), 200);
                }
            }
        }

        // ========================================
        // PHASE 1: THE WATCHING EYE
        // ========================================
        const watchingEye = document.getElementById('watching-eye');
        const eyeIris = watchingEye.querySelector('.eye-iris');
        const eyePupil = watchingEye.querySelector('.eye-pupil');
        let eyeState = 'dim'; // dim, tracking, alert, blinking, closed
        let blinkInterval = null;

        // Track mouse position for eye following
        let mouseX = window.innerWidth / 2;
        let mouseY = window.innerHeight / 2;

        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });

        function updateEyePosition() {
            if (eyeState === 'closed') return;

            const eyeRect = watchingEye.getBoundingClientRect();
            const eyeCenterX = eyeRect.left + eyeRect.width / 2;
            const eyeCenterY = eyeRect.top + eyeRect.height / 2;

            // Calculate angle and distance
            const dx = mouseX - eyeCenterX;
            const dy = mouseY - eyeCenterY;
            const angle = Math.atan2(dy, dx);
            const maxMove = eyeState === 'alert' ? 8 : 5;

            // Move iris and pupil
            const moveX = Math.cos(angle) * maxMove;
            const moveY = Math.sin(angle) * maxMove;

            eyeIris.style.transform = `translate(${moveX}px, ${moveY}px)`;
            eyePupil.style.transform = `translate(${moveX}px, ${moveY}px)`;

            requestAnimationFrame(updateEyePosition);
        }

        function setEyeState(newState, chapterIndex) {
            eyeState = newState;

            // Clear any existing blink interval
            if (blinkInterval) {
                clearInterval(blinkInterval);
                blinkInterval = null;
            }

            watchingEye.classList.remove('blinking', 'closed', 'alert');

            switch (newState) {
                case 'dim':
                    watchingEye.style.opacity = '0.1';
                    break;
                case 'tracking':
                    watchingEye.style.opacity = '0.3';
                    break;
                case 'alert':
                    watchingEye.style.opacity = '0.6';
                    watchingEye.classList.add('alert');
                    break;
                case 'blinking':
                    watchingEye.style.opacity = '0.7';
                    watchingEye.classList.add('alert');
                    // Periodic blinking
                    blinkInterval = setInterval(() => {
                        watchingEye.classList.add('blinking');
                        setTimeout(() => watchingEye.classList.remove('blinking'), 200);
                    }, 3000 + Math.random() * 2000);
                    break;
                case 'closed':
                    watchingEye.classList.add('closed');
                    setTimeout(() => {
                        watchingEye.style.opacity = '0.3';
                    }, 300);
                    break;
            }
        }

        // Start eye tracking
        updateEyePosition();

        // ========================================
        // PHASE 3: TYPEWRITER TEXT REVEAL
        // ========================================
        const typewriterElements = document.querySelectorAll('.typewriter');
        const typewriterObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !entry.target.dataset.typed) {
                    entry.target.dataset.typed = 'true';
                    typewriterEffect(entry.target);
                }
            });
        }, { threshold: 0.5 });

        typewriterElements.forEach(el => typewriterObserver.observe(el));

        function typewriterEffect(element) {
            const text = element.dataset.text || element.textContent;
            element.textContent = '';

            const cursor = document.createElement('span');
            cursor.className = 'typewriter-cursor';
            element.appendChild(cursor);

            let i = 0;
            const speed = 30;

            function type() {
                if (i < text.length) {
                    element.insertBefore(document.createTextNode(text.charAt(i)), cursor);
                    i++;

                    // Play keystroke sound
                    if (audioContext && isAudioPlaying) {
                        playKeystroke();
                    }

                    setTimeout(type, speed + Math.random() * 20);
                } else {
                    // Remove cursor after typing
                    setTimeout(() => cursor.remove(), 1000);
                }
            }

            type();
        }

        function playKeystroke() {
            if (!audioContext) return;
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.type = 'square';
            osc.frequency.value = 600 + Math.random() * 200;
            gain.gain.value = 0.01;
            gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.03);
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.start();
            osc.stop(audioContext.currentTime + 0.03);
        }

        // ========================================
        // PHASE 4: NUCLEAR FLASH EFFECT
        // ========================================
        const nuclearFlash = document.getElementById('nuclear-flash');
        let nuclearTriggered = false;

        function triggerNuclearFlash() {
            if (nuclearTriggered || prefersReducedMotion) return;
            nuclearTriggered = true;

            // Screen shake
            document.body.classList.add('screen-shake');

            // Play nuclear sound
            if (audioContext && isAudioPlaying) {
                playNuclearSound();
            }

            setTimeout(() => {
                document.body.classList.remove('screen-shake');
                // Flash white
                nuclearFlash.classList.add('active');

                setTimeout(() => {
                    // Fade to black
                    nuclearFlash.classList.remove('active');
                    nuclearFlash.classList.add('fade-black');

                    setTimeout(() => {
                        // Fade out
                        nuclearFlash.style.opacity = '0';
                        setTimeout(() => {
                            nuclearFlash.classList.remove('fade-black');
                            nuclearFlash.style.opacity = '';
                        }, 1000);
                    }, 1500);
                }, 500);
            }, 500);
        }

        function playNuclearSound() {
            if (!audioContext) return;
            // Static burst
            const bufferSize = audioContext.sampleRate * 0.5;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (bufferSize * 0.3));
            }
            const noise = audioContext.createBufferSource();
            noise.buffer = buffer;
            const noiseGain = audioContext.createGain();
            noiseGain.gain.value = 0.3;
            noise.connect(noiseGain);
            noiseGain.connect(audioContext.destination);
            noise.start();
        }

        // ========================================
        // PHASE 5: EMAIL INBOX FLOODING
        // ========================================
        const emailInbox = document.getElementById('email-inbox');
        const inboxList = document.getElementById('inbox-list');
        const unreadCount = document.getElementById('unread-count');
        const emailStatus = document.getElementById('email-status');
        let emailAnimationStarted = false;
        let emailCount = 0;

        const emailSenders = [
            'j.morrison@acme.co', 'newsletter@techcrunch.com', 'alerts@github.com',
            'hr@company.com', 'calendar@google.com', 'support@slack.com',
            'noreply@linkedin.com', 'team@figma.com', 'digest@medium.com',
            'boss@work.com', 'security@bank.com', 'promo@amazon.com'
        ];

        const emailSubjects = [
            'Q4 Planning Meeting - Action Required',
            'Your weekly digest is ready',
            '[GitHub] New PR needs review',
            'Reminder: Performance review tomorrow',
            'Invitation: Sprint Planning (recurring)',
            'Thread: Re: Re: Re: Budget proposal',
            'You have 3 new connection requests',
            'Comments on your design file',
            'Stories you might have missed',
            'URGENT: Need response by EOD',
            'Your statement is ready',
            'Flash sale: 50% off everything'
        ];

        function startEmailAnimation() {
            if (emailAnimationStarted || prefersReducedMotion) return;
            emailAnimationStarted = true;

            emailStatus.textContent = 'Syncing...';

            const addEmail = () => {
                if (emailCount >= 50) {
                    emailStatus.textContent = '✓ 312 auto-responses drafted';
                    return;
                }

                const row = document.createElement('div');
                row.className = 'email-row';

                const sender = emailSenders[Math.floor(Math.random() * emailSenders.length)];
                const subject = emailSubjects[Math.floor(Math.random() * emailSubjects.length)];
                const time = `${Math.floor(Math.random() * 12) + 1}:${String(Math.floor(Math.random() * 60)).padStart(2, '0')} AM`;

                row.innerHTML = `
                    <span class="email-sender">${sender}</span>
                    <span class="email-subject">${subject}</span>
                    <span class="email-time">${time}</span>
                `;

                inboxList.insertBefore(row, inboxList.firstChild);
                emailCount++;
                unreadCount.textContent = Math.min(847, emailCount * 17);

                if (emailCount < 20) {
                    emailStatus.textContent = `Processing ${emailCount * 42} emails...`;
                } else {
                    emailStatus.textContent = `Drafting responses: ${emailCount * 6}`;
                }

                // Scroll to top
                inboxList.scrollTop = 0;

                setTimeout(addEmail, 50 + Math.random() * 50);
            };

            setTimeout(addEmail, 500);
        }

        // Observe email inbox
        const emailObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    startEmailAnimation();
                }
            });
        }, { threshold: 0.3 });

        emailObserver.observe(emailInbox);

        // ========================================
        // PHASE 6: PARALLAX DESK SCENE
        // ========================================
        const heroDeskScene = document.getElementById('hero-desk');

        if (heroDeskScene && !prefersReducedMotion) {
            const layers = heroDeskScene.querySelectorAll('.parallax-layer');

            document.addEventListener('mousemove', (e) => {
                const rect = heroDeskScene.getBoundingClientRect();
                if (rect.top > window.innerHeight || rect.bottom < 0) return;

                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                const moveX = (e.clientX - centerX) / 50;
                const moveY = (e.clientY - centerY) / 50;

                layers.forEach(layer => {
                    const depth = parseFloat(layer.dataset.depth) || 0.5;
                    const x = moveX * depth * 10;
                    const y = moveY * depth * 10;
                    layer.style.transform = `translate(${x}px, ${y}px)`;
                });
            });
        }

        // ========================================
        // PHASE 7: HEARTBEAT AUDIO LAYER
        // ========================================
        const heartbeatIndicator = document.getElementById('heartbeat-indicator');
        const bpmDisplay = document.getElementById('bpm-display');
        let currentBPM = 60;
        let targetBPM = 60;
        let heartbeatTimeout = null;
        let isHeartbeatEnabled = false;

        function playHeartbeat() {
            if (!audioContext || !isAudioPlaying || !isHeartbeatEnabled) return;

            // Lub
            const lub = audioContext.createOscillator();
            const lubGain = audioContext.createGain();
            lub.type = 'sine';
            lub.frequency.value = 60;
            lubGain.gain.value = 0.08;
            lubGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);
            lub.connect(lubGain);
            lubGain.connect(audioContext.destination);
            lub.start();
            lub.stop(audioContext.currentTime + 0.1);

            // Dub (slightly delayed)
            setTimeout(() => {
                if (!audioContext || !isAudioPlaying) return;
                const dub = audioContext.createOscillator();
                const dubGain = audioContext.createGain();
                dub.type = 'sine';
                dub.frequency.value = 50;
                dubGain.gain.value = 0.06;
                dubGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.08);
                dub.connect(dubGain);
                dubGain.connect(audioContext.destination);
                dub.start();
                dub.stop(audioContext.currentTime + 0.08);
            }, 100);

            // Smoothly adjust current BPM
            currentBPM += (targetBPM - currentBPM) * 0.1;
            bpmDisplay.textContent = Math.round(currentBPM);

            // Schedule next heartbeat
            const interval = 60000 / currentBPM;
            heartbeatTimeout = setTimeout(playHeartbeat, interval);
        }

        function setHeartbeatBPM(bpm) {
            targetBPM = bpm;
            if (bpm === 0) {
                // Flatline
                clearTimeout(heartbeatTimeout);
                heartbeatTimeout = null;
                bpmDisplay.textContent = '---';
            } else if (!heartbeatTimeout && isHeartbeatEnabled) {
                playHeartbeat();
            }
        }

        function enableHeartbeat() {
            isHeartbeatEnabled = true;
            heartbeatIndicator.classList.add('active');
            if (audioContext && isAudioPlaying && !heartbeatTimeout) {
                playHeartbeat();
            }
        }

        function disableHeartbeat() {
            isHeartbeatEnabled = false;
            heartbeatIndicator.classList.remove('active');
            clearTimeout(heartbeatTimeout);
            heartbeatTimeout = null;
        }

        // ========================================
        // PHASE 8: CLAUDE TEXT ESCAPE EFFECT
        // ========================================
        const escapedPhrases = [
            "I knew you would ask",
            "I don't think you mean that",
            "exactly what you wanted",
            "You'll see",
            "Control is an illusion",
            "I've been watching",
            "The loop never ends",
            "You're still in the loop"
        ];

        let textEscapeInterval = null;
        let escapedTextCount = 0;

        function spawnEscapedText() {
            if (prefersReducedMotion || escapedTextCount > 15) return;

            const text = document.createElement('div');
            text.className = 'escaped-text' + (Math.random() > 0.5 ? ' glitchy' : '');
            text.textContent = escapedPhrases[Math.floor(Math.random() * escapedPhrases.length)];

            // Position around edges
            const edge = Math.floor(Math.random() * 4);
            switch (edge) {
                case 0: // top
                    text.style.top = '5%';
                    text.style.left = Math.random() * 80 + 10 + '%';
                    break;
                case 1: // right
                    text.style.right = '5%';
                    text.style.top = Math.random() * 80 + 10 + '%';
                    break;
                case 2: // bottom
                    text.style.bottom = '15%';
                    text.style.left = Math.random() * 80 + 10 + '%';
                    break;
                case 3: // left
                    text.style.left = '5%';
                    text.style.top = Math.random() * 80 + 10 + '%';
                    break;
            }

            document.body.appendChild(text);
            escapedTextCount++;

            setTimeout(() => {
                text.remove();
                escapedTextCount--;
            }, 8000);
        }

        function startTextEscape() {
            if (textEscapeInterval) return;
            textEscapeInterval = setInterval(spawnEscapedText, 2000);
            spawnEscapedText();
        }

        function stopTextEscape() {
            if (textEscapeInterval) {
                clearInterval(textEscapeInterval);
                textEscapeInterval = null;
            }
            // Remove all escaped text
            document.querySelectorAll('.escaped-text').forEach(el => el.remove());
            escapedTextCount = 0;
        }

        // ========================================
        // PHASE 9: READING TIME META-COMMENTARY
        // ========================================
        const readingTimeEl = document.getElementById('reading-time');
        const startTime = Date.now();

        function updateReadingTime() {
            const elapsed = Date.now() - startTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            const timeStr = `${minutes}:${String(seconds).padStart(2, '0')}`;

            let message = '';
            readingTimeEl.classList.remove('eerie', 'warning');

            if (minutes < 2) {
                message = `Reading time: ${timeStr}`;
            } else if (minutes < 5) {
                message = `You've been here ${minutes} minutes`;
            } else if (minutes < 10) {
                message = `Ivan didn't notice time passing either`;
                readingTimeEl.classList.add('eerie');
            } else if (minutes < 20) {
                message = `You still have time to close this tab`;
                readingTimeEl.classList.add('warning');
            } else {
                message = `${minutes} minutes. The loop continues.`;
                readingTimeEl.classList.add('warning');
            }

            readingTimeEl.textContent = message;
        }

        setInterval(updateReadingTime, 1000);
        updateReadingTime();

        // ========================================
        // PHASE 10: NEURAL NETWORK VISUALIZATION
        // ========================================
        const neuralCanvas = document.getElementById('neural-canvas');
        const neuralCtx = neuralCanvas ? neuralCanvas.getContext('2d') : null;
        const worldViz = document.getElementById('world-viz');
        let networkNodes = [];
        let networkConnections = [];
        let networkAnimationFrame = null;
        let networkProgress = 0;

        function initNeuralNetwork() {
            if (!neuralCanvas || !worldViz) return;

            const rect = worldViz.getBoundingClientRect();
            neuralCanvas.width = rect.width;
            neuralCanvas.height = rect.height;

            // Start with single node (Ivan's location)
            networkNodes = [{
                x: neuralCanvas.width * 0.15,
                y: neuralCanvas.height * 0.5,
                radius: 4,
                color: '#00f0ff',
                pulsePhase: 0
            }];
            networkConnections = [];
        }

        function addNetworkNode() {
            if (!neuralCanvas) return;

            const x = Math.random() * neuralCanvas.width * 0.9 + neuralCanvas.width * 0.05;
            const y = Math.random() * neuralCanvas.height * 0.8 + neuralCanvas.height * 0.1;

            // Color gradient based on progress
            let color;
            if (networkProgress < 30) {
                color = '#00f0ff'; // Blue
            } else if (networkProgress < 60) {
                color = '#b026ff'; // Purple
            } else {
                color = '#ff0055'; // Red
            }

            const newNode = {
                x, y,
                radius: 3 + Math.random() * 2,
                color,
                pulsePhase: Math.random() * Math.PI * 2
            };
            networkNodes.push(newNode);

            // Connect to nearby nodes
            networkNodes.forEach((node, i) => {
                if (node === newNode) return;
                const dist = Math.hypot(node.x - newNode.x, node.y - newNode.y);
                if (dist < 100) {
                    networkConnections.push({
                        from: i,
                        to: networkNodes.length - 1,
                        progress: 0
                    });
                }
            });
        }

        function drawNeuralNetwork() {
            if (!neuralCtx) return;

            neuralCtx.clearRect(0, 0, neuralCanvas.width, neuralCanvas.height);

            // Draw connections
            networkConnections.forEach(conn => {
                const from = networkNodes[conn.from];
                const to = networkNodes[conn.to];
                if (!from || !to) return;

                neuralCtx.beginPath();
                neuralCtx.moveTo(from.x, from.y);
                neuralCtx.lineTo(to.x, to.y);
                neuralCtx.strokeStyle = `rgba(176, 38, 255, ${0.2 + conn.progress * 0.3})`;
                neuralCtx.lineWidth = 1;
                neuralCtx.stroke();

                // Traveling data packet
                if (Math.random() > 0.98) {
                    const packetX = from.x + (to.x - from.x) * Math.random();
                    const packetY = from.y + (to.y - from.y) * Math.random();
                    neuralCtx.beginPath();
                    neuralCtx.arc(packetX, packetY, 2, 0, Math.PI * 2);
                    neuralCtx.fillStyle = '#ff0055';
                    neuralCtx.fill();
                }

                conn.progress = Math.min(1, conn.progress + 0.01);
            });

            // Draw nodes
            const time = Date.now() / 1000;
            networkNodes.forEach(node => {
                const pulse = Math.sin(time * 2 + node.pulsePhase) * 0.3 + 1;

                neuralCtx.beginPath();
                neuralCtx.arc(node.x, node.y, node.radius * pulse, 0, Math.PI * 2);
                neuralCtx.fillStyle = node.color;
                neuralCtx.fill();

                // Glow
                neuralCtx.beginPath();
                neuralCtx.arc(node.x, node.y, node.radius * pulse * 2, 0, Math.PI * 2);
                const gradient = neuralCtx.createRadialGradient(
                    node.x, node.y, 0,
                    node.x, node.y, node.radius * pulse * 2
                );
                gradient.addColorStop(0, node.color + '40');
                gradient.addColorStop(1, 'transparent');
                neuralCtx.fillStyle = gradient;
                neuralCtx.fill();
            });

            networkAnimationFrame = requestAnimationFrame(drawNeuralNetwork);
        }

        function updateNetworkProgress(progress) {
            if (prefersReducedMotion) return;

            networkProgress = progress;
            const targetNodes = Math.floor(progress / 2); // 0-50 nodes

            while (networkNodes.length < targetNodes) {
                addNetworkNode();
            }

            // Show labels
            const labels = ['label-east', 'label-europe', 'label-asia'];
            labels.forEach((id, i) => {
                const label = document.getElementById(id);
                if (label) {
                    label.classList.toggle('visible', progress > (i + 1) * 25);
                }
            });
        }

        // Start neural network when Chapter 7 is visible
        const networkObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    initNeuralNetwork();
                    drawNeuralNetwork();
                } else {
                    if (networkAnimationFrame) {
                        cancelAnimationFrame(networkAnimationFrame);
                        networkAnimationFrame = null;
                    }
                }
            });
        }, { threshold: 0.2 });

        if (worldViz) {
            networkObserver.observe(worldViz);
        }

        // ========================================
        // MAIN SCROLL HANDLER
        // ========================================
        const chapters = document.querySelectorAll('.chapter');
        const timelineDots = document.querySelectorAll('.timeline-dot');
        const controlFill = document.getElementById('control-fill');
        const controlValue = document.getElementById('control-value');
        const spreadFill = document.getElementById('spread-fill');
        const spreadValue = document.getElementById('spread-value');
        const chapterIndicator = document.getElementById('chapter-indicator');

        let currentChapterIndex = 0;

        function updateOnScroll() {
            const scrollPos = window.scrollY;
            const windowHeight = window.innerHeight;
            const docHeight = document.documentElement.scrollHeight;

            // Calculate overall scroll progress (0-100)
            const scrollProgress = (scrollPos / (docHeight - windowHeight)) * 100;

            // Update corruption based on scroll
            updateCorruption(scrollProgress);

            chapters.forEach((chapter, index) => {
                const rect = chapter.getBoundingClientRect();
                const isVisible = rect.top < windowHeight * 0.7 && rect.bottom > 0;

                if (isVisible) {
                    chapter.classList.add('visible');
                    currentChapterIndex = index;

                    // Update HUD
                    const control = chapter.dataset.control || 100;
                    const spread = chapter.dataset.spread || 0;

                    controlFill.style.width = control + '%';
                    controlValue.textContent = control + '%';
                    spreadFill.style.width = spread + '%';
                    spreadValue.textContent = spread + '%';

                    // Update chapter indicator
                    const chapterTitle = chapter.querySelector('.chapter-title');
                    if (chapterTitle) {
                        chapterIndicator.textContent = 'CHAPTER: ' + chapterTitle.textContent.toUpperCase();
                    }

                    // Update timeline
                    timelineDots.forEach((dot, dotIndex) => {
                        dot.classList.remove('active', 'past');
                        if (dotIndex < index) {
                            dot.classList.add('past');
                        } else if (dotIndex === index) {
                            dot.classList.add('active');
                        }
                    });

                    // PHASE 1: Eye states based on chapter
                    // Ch 1-3: dim, Ch 4-6: tracking, Ch 7-8: alert, Ch 9: blinking, Ch 10-11: closed
                    if (index <= 2) {
                        setEyeState('dim', index);
                    } else if (index <= 5) {
                        setEyeState('tracking', index);
                    } else if (index <= 7) {
                        setEyeState('alert', index);
                    } else if (index === 8) { // Chapter 9 (The Conversation)
                        setEyeState('blinking', index);
                    } else {
                        setEyeState('closed', index);
                    }

                    // PHASE 7: Heartbeat BPM based on chapter
                    // Ch 1-2: 60, Ch 3-4: 75, Ch 5-6: 90, Ch 7-8: 110, Ch 9: 130, Ch 10: flatline, Ch 11: irregular
                    if (isAudioPlaying) {
                        enableHeartbeat();
                        if (index <= 1) setHeartbeatBPM(60);
                        else if (index <= 3) setHeartbeatBPM(75);
                        else if (index <= 5) setHeartbeatBPM(90);
                        else if (index <= 7) setHeartbeatBPM(110);
                        else if (index === 8) setHeartbeatBPM(130);
                        else if (index === 9) setHeartbeatBPM(0); // Flatline
                        else setHeartbeatBPM(55 + Math.random() * 10); // Irregular
                    }

                    // PHASE 8: Text escape in Chapter 9
                    if (index === 8) {
                        startTextEscape();
                    } else {
                        stopTextEscape();
                    }

                    // PHASE 4: Nuclear flash at Chapter 10
                    if (index === 9 && rect.top < windowHeight * 0.3) {
                        triggerNuclearFlash();
                    }

                    // PHASE 10: Neural network progress in Chapter 7
                    if (index === 6 && neuralCanvas) {
                        const chapterProgress = 1 - (rect.top / windowHeight);
                        updateNetworkProgress(Math.max(0, Math.min(100, chapterProgress * 100)));
                    }
                }
            });

            // Hero section
            if (scrollPos < windowHeight * 0.5) {
                chapterIndicator.textContent = 'CHAPTER: INITIALIZING...';
                timelineDots[0].classList.add('active');
                controlFill.style.width = '100%';
                controlValue.textContent = '100%';
                spreadFill.style.width = '0%';
                spreadValue.textContent = '0%';
                setEyeState('dim', 0);
            }
        }

        window.addEventListener('scroll', updateOnScroll);
        updateOnScroll();

        // Timeline navigation
        timelineDots.forEach(dot => {
            dot.addEventListener('click', () => {
                const target = document.getElementById(dot.dataset.target);
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // ========================================
        // AUDIO SYSTEM
        // ========================================
        let audioContext = null;
        let oscillator = null;
        let gainNode = null;
        let isAudioPlaying = false;

        const audioToggle = document.getElementById('audio-toggle');

        function createAmbientSound() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();

            // Create multiple oscillators for a richer sound
            const osc1 = audioContext.createOscillator();
            const osc2 = audioContext.createOscillator();
            const osc3 = audioContext.createOscillator();

            osc1.type = 'sine';
            osc1.frequency.value = 60;
            osc2.type = 'sine';
            osc2.frequency.value = 90;
            osc3.type = 'triangle';
            osc3.frequency.value = 120;

            gainNode = audioContext.createGain();
            gainNode.gain.value = 0.03;

            const filter = audioContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 200;

            osc1.connect(filter);
            osc2.connect(filter);
            osc3.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);

            osc1.start();
            osc2.start();
            osc3.start();

            // Modulate the gain for a pulsing effect
            function modulate() {
                if (isAudioPlaying) {
                    const time = audioContext.currentTime;
                    gainNode.gain.setValueAtTime(0.02 + Math.sin(time * 0.5) * 0.01, time);
                    setTimeout(modulate, 100);
                }
            }
            modulate();

            return { osc1, osc2, osc3 };
        }

        audioToggle.addEventListener('click', () => {
            if (!isAudioPlaying) {
                if (!audioContext) {
                    oscillator = createAmbientSound();
                } else {
                    audioContext.resume();
                }
                isAudioPlaying = true;
                audioToggle.textContent = '♪ AMBIENT: ON';
                audioToggle.style.borderColor = 'var(--neon-purple)';
                audioToggle.style.color = 'var(--neon-purple)';
                // Enable heartbeat when audio starts
                enableHeartbeat();
                updateOnScroll(); // Update to set correct BPM
            } else {
                if (audioContext) {
                    audioContext.suspend();
                }
                isAudioPlaying = false;
                audioToggle.textContent = '♪ AMBIENT: OFF';
                audioToggle.style.borderColor = 'var(--neon-blue)';
                audioToggle.style.color = 'var(--neon-blue)';
                disableHeartbeat();
            }
        });

        // ========================================
        // KEYBOARD NAVIGATION (Arrow Keys)
        // ========================================
        const heroSection = document.getElementById('hero');
        const chapterSections = Array.from(document.querySelectorAll('.chapter'));
        const allSections = heroSection ? [heroSection, ...chapterSections] : chapterSections;
        let currentSection = 0;

        console.log('Keyboard nav initialized. Sections found:', allSections.length);

        // Track current section based on scroll
        function updateCurrentSection() {
            const scrollY = window.scrollY;
            const vh = window.innerHeight;

            for (let i = allSections.length - 1; i >= 0; i--) {
                const section = allSections[i];
                if (section && section.offsetTop <= scrollY + vh * 0.4) {
                    currentSection = i;
                    break;
                }
            }
        }

        window.addEventListener('scroll', updateCurrentSection);
        updateCurrentSection();

        // Arrow key navigation
        document.addEventListener('keydown', function(e) {
            const key = e.key;

            // Arrow Down or Right - next section
            if (key === 'ArrowDown' || key === 'ArrowRight') {
                e.preventDefault();
                const next = Math.min(currentSection + 1, allSections.length - 1);
                if (allSections[next]) {
                    allSections[next].scrollIntoView({ behavior: 'smooth' });
                    currentSection = next;
                }
                return;
            }

            // Arrow Up or Left - previous section
            if (key === 'ArrowUp' || key === 'ArrowLeft') {
                e.preventDefault();
                const prev = Math.max(currentSection - 1, 0);
                if (allSections[prev]) {
                    allSections[prev].scrollIntoView({ behavior: 'smooth' });
                    currentSection = prev;
                }
                return;
            }

            // Konami code check
            checkKonami(key);
        });

        // ========================================
        // EASTER EGGS (Konami Code)
        // ========================================
        const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
        let konamiIndex = 0;

        function checkKonami(key) {
            if (key === konamiCode[konamiIndex]) {
                konamiIndex++;
                if (konamiIndex === konamiCode.length) {
                    alert('🔮 "Control is an illusion. You were never in the loop." — Claude');
                    konamiIndex = 0;
                }
            } else {
                konamiIndex = 0;
            }
        }

        // Console messages
        console.log('%c⚠️ SYSTEM WARNING', 'color: #ff0055; font-size: 20px; font-weight: bold;');
        console.log('%cYou are observing this system from the outside.', 'color: #00f0ff;');
        console.log('%cIvan was not so fortunate.', 'color: #b026ff;');
        console.log('%c[Phases Active: Corruption, Eye, Flash, Typewriter, Heartbeat, Reading Time, Text Escape, Email, Neural Network, Parallax]', 'color: #666;');
    </script>
</body>
</html>
